<!DOCTYPE html>
<html>
<head>
<title>The MSD Book :: Perf Test Tools</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<p>
  <img src="msd-book-front.png" 
    alt="The MSD Book" width="200" style="float: left; margin: 0 1rem 1rem 0;"/>
  We present below a ready-to-run, self-contained demo that shows <strong>how to performance-test a simple web API</strong> using <strong>JMeter, Gatling, Locust, and k6</strong>. Everything runs in Docker/Podman. The API is a small FastAPI app with a few endpoints that simulate realistic workloads (CPU work, IO/sleep, auth, file upload, variable latency). We provide the project layout, all files, Dockerfiles, test scripts for each tool, and exact commands to run the tests.</p>
<p>You can copy the tree to a folder, run one command to bring up the API, then run each tool’s test from its container. No internet access from inside containers is required except to pull images.</p>
<hr>
<h1 id="project-layout">Project layout</h1>
<pre class="hljs"><code><div>perf-demo/
├─ api/
│  ├─ Dockerfile
│  ├─ requirements.txt
│  └─ main.py
├─ docker-compose.yml
├─ jmeter/
│  ├─ test-plan.jmx
│  └─ Dockerfile (optional)
├─ gatling/
│  └─ user-simulations/
│     └─ BasicSimulation.scala
├─ locust/
│  └─ locustfile.py
├─ k6/
│  └─ script.js
└─ README.md
</div></code></pre>
<hr>
<h1 id="1-the-api-fastapi--apimainpy">1) The API (FastAPI) — <code>api/main.py</code></h1>
<p>This API exposes endpoints commonly tested in real apps.</p>
<p>Create <code>perf-demo/api/main.py</code>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, File, UploadFile, Header, HTTPException
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> hashlib

app = FastAPI()

<span class="hljs-meta">@app.get("/")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">root</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"msg"</span>: <span class="hljs-string">"perf-demo ok"</span>}

<span class="hljs-comment"># CPU-bound-ish work: hash a buffer many times</span>
<span class="hljs-meta">@app.get("/work/cpu")</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cpu_work</span><span class="hljs-params">(iterations: int = <span class="hljs-number">10000</span>)</span>:</span>
    s = <span class="hljs-string">"x"</span> * <span class="hljs-number">1024</span>
    h = hashlib.sha256()
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(iterations):
        h.update(s.encode())
        <span class="hljs-comment"># mix to avoid optimization</span>
        s = h.hexdigest()
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"iterations"</span>: iterations, <span class="hljs-string">"hash"</span>: h.hexdigest()[:<span class="hljs-number">16</span>]}

<span class="hljs-comment"># IO simulation (blocking sleep)</span>
<span class="hljs-meta">@app.get("/work/io")</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">io_work</span><span class="hljs-params">(ms: int = <span class="hljs-number">100</span>)</span>:</span>
    time.sleep(ms / <span class="hljs-number">1000.0</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"slept_ms"</span>: ms}

<span class="hljs-comment"># Async sleep to simulate async I/O (non-blocking)</span>
<span class="hljs-meta">@app.get("/work/async_io")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">async_io</span><span class="hljs-params">(ms: int = <span class="hljs-number">100</span>)</span>:</span>
    <span class="hljs-keyword">await</span> asyncio.sleep(ms / <span class="hljs-number">1000.0</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"slept_ms"</span>: ms}

<span class="hljs-comment"># Auth-protected endpoint requiring header X-API-KEY</span>
<span class="hljs-meta">@app.get("/private")</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">private</span><span class="hljs-params">(x_api_key: str | None = Header<span class="hljs-params">(None)</span>)</span>:</span>
    <span class="hljs-keyword">if</span> x_api_key != <span class="hljs-string">"secret-key"</span>:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">401</span>, detail=<span class="hljs-string">"missing/invalid key"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"secret"</span>: <span class="hljs-string">"42"</span>}

<span class="hljs-comment"># Upload endpoint (accepts file, reads bytes to simulate processing)</span>
<span class="hljs-meta">@app.post("/upload")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upload</span><span class="hljs-params">(file: UploadFile = File<span class="hljs-params">(...)</span>)</span>:</span>
    data = <span class="hljs-keyword">await</span> file.read()
    <span class="hljs-comment"># simulate processing</span>
    s = len(data)
    <span class="hljs-comment"># quick checksum</span>
    checksum = hashlib.md5(data).hexdigest()[:<span class="hljs-number">8</span>]
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"filename"</span>: file.filename, <span class="hljs-string">"size"</span>: s, <span class="hljs-string">"checksum"</span>: checksum}

<span class="hljs-comment"># Endpoint with variable latency (some requests slow)</span>
<span class="hljs-meta">@app.get("/random-delay")</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_delay</span><span class="hljs-params">()</span>:</span>
    d = random.choice([<span class="hljs-number">20</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">500</span>, <span class="hljs-number">1000</span>]) / <span class="hljs-number">1000.0</span>
    time.sleep(d)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"delay_ms"</span>: int(d * <span class="hljs-number">1000</span>)}
</div></code></pre>
<p>Create <code>perf-demo/api/requirements.txt</code>:</p>
<pre class="hljs"><code><div>fastapi==0.95.2
uvicorn[standard]==0.22.0
</div></code></pre>
<p>Create <code>perf-demo/api/Dockerfile</code>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.11</span>-slim
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>
<span class="hljs-keyword">COPY</span><span class="bash"> requirements.txt .</span>
<span class="hljs-keyword">RUN</span><span class="bash"> pip install --no-cache-dir -r requirements.txt</span>
<span class="hljs-keyword">COPY</span><span class="bash"> main.py .</span>
<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8000</span>
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">"uvicorn"</span>, <span class="hljs-string">"main:app"</span>, <span class="hljs-string">"--host"</span>, <span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-string">"--port"</span>, <span class="hljs-string">"8000"</span>, <span class="hljs-string">"--workers"</span>, <span class="hljs-string">"1"</span>]</span>
</div></code></pre>
<hr>
<h1 id="2-docker-compose-bring-up-api">2) docker-compose (bring up API)</h1>
<p>Create <code>perf-demo/docker-compose.yml</code>:</p>
<pre class="hljs"><code><div><span class="hljs-attr">version:</span> <span class="hljs-string">"3.8"</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./api</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">perf_api</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8000:8000"</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-comment"># small memory limit optional:</span>
    <span class="hljs-comment"># deploy: resources: limits: memory: 512M</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">perfnet</span>

  <span class="hljs-comment"># You can optionally define runner services here,</span>
  <span class="hljs-comment"># but we'll run test containers manually to mount scripts.</span>
<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">perfnet:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</div></code></pre>
<p>Start the API:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># from perf-demo/</span>
docker-compose up -d --build
<span class="hljs-comment"># or: podman-compose up -d --build</span>
</div></code></pre>
<p>Verify:</p>
<pre class="hljs"><code><div>curl http://localhost:8000/
<span class="hljs-comment"># {"msg":"perf-demo ok"}</span>
</div></code></pre>
<hr>
<h1 id="3-k6-test-js--quick-and-easy">3) k6 test (JS) — quick and easy</h1>
<p>Create <code>perf-demo/k6/script.js</code>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'k6/http'</span>;
<span class="hljs-keyword">import</span> { check, sleep } <span class="hljs-keyword">from</span> <span class="hljs-string">'k6'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> options = {
  <span class="hljs-attr">vus</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">duration</span>: <span class="hljs-string">'30s'</span>,
  <span class="hljs-attr">thresholds</span>: {
    <span class="hljs-attr">http_req_duration</span>: [<span class="hljs-string">'p(95)&lt;500'</span>]
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> res = http.get(<span class="hljs-string">'http://api:8000/random-delay'</span>);
  check(res, { <span class="hljs-string">'status 200'</span>: <span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.status === <span class="hljs-number">200</span> });
  sleep(<span class="hljs-number">0.1</span>);
}
</div></code></pre>
<p>Run with Docker (k6 official image). We use docker network to call <code>api</code> service by service name when running inside the same Docker network <code>perfnet</code>. Start test:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># create network if not created by compose</span>
docker network create perf_demo_perfnet || <span class="hljs-literal">true</span>

<span class="hljs-comment"># run k6 container (mount script)</span>
docker run --rm -i --network perf_demo_perfnet \
  -v $(<span class="hljs-built_in">pwd</span>)/k6/script.js:/script.js \
  loadimpact/k6 run /script.js
</div></code></pre>
<p>If using <code>docker-compose</code> network name as in file, the network will exist as <code>perf-demo_perfnet</code> — adjust the name shown by <code>docker network ls</code>.</p>
<p>k6 will print summary metrics. Modify <code>options</code> for more advanced scenarios (auth, upload, POSTs).</p>
<hr>
<h1 id="4-locust-python--real-time-web-ui">4) Locust (Python) — real-time web UI</h1>
<p>Create <code>perf-demo/locust/locustfile.py</code>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> locust <span class="hljs-keyword">import</span> HttpUser, task, between, TaskSet
<span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserBehavior</span><span class="hljs-params">(TaskSet)</span>:</span>
<span class="hljs-meta">    @task(3)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span><span class="hljs-params">(self)</span>:</span>
        self.client.get(<span class="hljs-string">"/"</span>)

<span class="hljs-meta">    @task(2)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_delay</span><span class="hljs-params">(self)</span>:</span>
        self.client.get(<span class="hljs-string">"/random-delay"</span>)

<span class="hljs-meta">    @task(1)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cpu</span><span class="hljs-params">(self)</span>:</span>
        self.client.get(<span class="hljs-string">"/work/cpu"</span>, params={<span class="hljs-string">"iterations"</span>: <span class="hljs-number">2000</span>})

<span class="hljs-meta">    @task(1)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">auth</span><span class="hljs-params">(self)</span>:</span>
        self.client.get(<span class="hljs-string">"/private"</span>, headers={<span class="hljs-string">"X-API-KEY"</span>: <span class="hljs-string">"secret-key"</span>})

<span class="hljs-meta">    @task(1)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upload</span><span class="hljs-params">(self)</span>:</span>
        data = BytesIO(<span class="hljs-string">b"x"</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">50</span>)  <span class="hljs-comment"># 50 KB file</span>
        files = {<span class="hljs-string">"file"</span>: (<span class="hljs-string">"blob.bin"</span>, data)}
        self.client.post(<span class="hljs-string">"/upload"</span>, files=files)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebsiteUser</span><span class="hljs-params">(HttpUser)</span>:</span>
    tasks = [UserBehavior]
    wait_time = between(<span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>)
    host = <span class="hljs-string">"http://api:8000"</span>
</div></code></pre>
<p>Run Locust UI:</p>
<pre class="hljs"><code><div>docker run --rm -p 8089:8089 -v $(<span class="hljs-built_in">pwd</span>)/locust/locustfile.py:/locustfile.py --network perf_demo_perfnet \
  locustio/locust -f /locustfile.py --host http://api:8000
</div></code></pre>
<p>Open <code>http://localhost:8089</code> to control ramp-up / number of users. (Use the UI to start test. Locust gives live charts.)</p>
<p>If you prefer headless:</p>
<pre class="hljs"><code><div>docker run --rm --network perf_demo_perfnet -v $(<span class="hljs-built_in">pwd</span>)/locust/locustfile.py:/locustfile.py locustio/locust \
  -f /locustfile.py --headless -u 100 -r 10 --run-time 1m
</div></code></pre>
<hr>
<h1 id="5-jmeter--guitest-plan-jmx">5) JMeter — GUI/test-plan .jmx</h1>
<p>Create <code>perf-demo/jmeter/test-plan.jmx</code>.</p>
<blockquote>
<p>JMeter .jmx files are XML. Below is a compact test-plan that: Thread Group -&gt; HTTP Request to <code>/random-delay</code>. Save as <code>test-plan.jmx</code>.</p>
</blockquote>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">jmeterTestPlan</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.2"</span> <span class="hljs-attr">properties</span>=<span class="hljs-string">"5.0"</span> <span class="hljs-attr">jmeter</span>=<span class="hljs-string">"5.6.3"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">hashTree</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">TestPlan</span> <span class="hljs-attr">guiclass</span>=<span class="hljs-string">"TestPlanGui"</span> <span class="hljs-attr">testclass</span>=<span class="hljs-string">"TestPlan"</span> <span class="hljs-attr">testname</span>=<span class="hljs-string">"Perf Demo Test Plan"</span> <span class="hljs-attr">enabled</span>=<span class="hljs-string">"true"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"TestPlan.comments"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">boolProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"TestPlan.functional_mode"</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">boolProp</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">elementProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"TestPlan.user_defined_variables"</span> <span class="hljs-attr">elementType</span>=<span class="hljs-string">"Arguments"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">collectionProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Arguments.arguments"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">elementProp</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"TestPlan.serialize_threadgroups"</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">TestPlan</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">hashTree</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ThreadGroup</span> <span class="hljs-attr">guiclass</span>=<span class="hljs-string">"ThreadGroupGui"</span> <span class="hljs-attr">testclass</span>=<span class="hljs-string">"ThreadGroup"</span> <span class="hljs-attr">testname</span>=<span class="hljs-string">"Thread Group"</span> <span class="hljs-attr">enabled</span>=<span class="hljs-string">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ThreadGroup.on_sample_error"</span>&gt;</span>continue<span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elementProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ThreadGroup.main_controller"</span> <span class="hljs-attr">elementType</span>=<span class="hljs-string">"LoopController"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">boolProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LoopController.continue_forever"</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">boolProp</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">intProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LoopController.loops"</span>&gt;</span>100<span class="hljs-tag">&lt;/<span class="hljs-name">intProp</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elementProp</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">intProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ThreadGroup.num_threads"</span>&gt;</span>50<span class="hljs-tag">&lt;/<span class="hljs-name">intProp</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">longProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ThreadGroup.ramp_time"</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">longProp</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">boolProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ThreadGroup.scheduler"</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">boolProp</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ThreadGroup</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">hashTree</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">HTTPSamplerProxy</span> <span class="hljs-attr">guiclass</span>=<span class="hljs-string">"HttpTestSampleGui"</span> <span class="hljs-attr">testclass</span>=<span class="hljs-string">"HTTPSamplerProxy"</span> <span class="hljs-attr">testname</span>=<span class="hljs-string">"GET /random-delay"</span> <span class="hljs-attr">enabled</span>=<span class="hljs-string">"true"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elementProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HTTPsampler.Arguments"</span> <span class="hljs-attr">elementType</span>=<span class="hljs-string">"Arguments"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">collectionProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Arguments.arguments"</span>/&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">elementProp</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HTTPSampler.domain"</span>&gt;</span>api<span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HTTPSampler.port"</span>&gt;</span>8000<span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HTTPSampler.protocol"</span>&gt;</span>http<span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HTTPSampler.path"</span>&gt;</span>/random-delay<span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">stringProp</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HTTPSampler.method"</span>&gt;</span>GET<span class="hljs-tag">&lt;/<span class="hljs-name">stringProp</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">HTTPSamplerProxy</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">hashTree</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">hashTree</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">hashTree</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">hashTree</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">jmeterTestPlan</span>&gt;</span>
</div></code></pre>
<p>Run JMeter headless with the official image:</p>
<pre class="hljs"><code><div>docker run --rm --network perf_demo_perfnet -v $(<span class="hljs-built_in">pwd</span>)/jmeter/<span class="hljs-built_in">test</span>-plan.jmx:/<span class="hljs-built_in">test</span>-plan.jmx \
  justb4/jmeter -n -t /<span class="hljs-built_in">test</span>-plan.jmx -l /results.jtl
</div></code></pre>
<p>This runs a non-GUI test and writes <code>results.jtl</code> to container (you can mount host output folder to persist results).</p>
<p>If you want to run JMeter GUI locally, install JMeter and open the <code>test-plan.jmx</code> in the GUI.</p>
<hr>
<h1 id="6-gatling--scala-simulation">6) Gatling — Scala simulation</h1>
<p>Create <code>perf-demo/gatling/user-simulations/BasicSimulation.scala</code>:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> io.gatling.core.<span class="hljs-type">Predef</span>._
<span class="hljs-keyword">import</span> io.gatling.http.<span class="hljs-type">Predef</span>._
<span class="hljs-keyword">import</span> scala.concurrent.duration._

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicSimulation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Simulation</span> </span>{

  <span class="hljs-keyword">val</span> httpProtocol = http
    .baseUrl(<span class="hljs-string">"http://api:8000"</span>)
    .acceptHeader(<span class="hljs-string">"application/json"</span>)

  <span class="hljs-keyword">val</span> scn = scenario(<span class="hljs-string">"BasicScenario"</span>)
    .exec(http(<span class="hljs-string">"get-root"</span>).get(<span class="hljs-string">"/"</span>))
    .pause(<span class="hljs-number">100.</span>milliseconds)
    .exec(http(<span class="hljs-string">"random-delay"</span>).get(<span class="hljs-string">"/random-delay"</span>))
    .pause(<span class="hljs-number">50.</span>milliseconds)
    .exec(http(<span class="hljs-string">"cpu-work"</span>).get(<span class="hljs-string">"/work/cpu"</span>)
      .queryParam(<span class="hljs-string">"iterations"</span>, <span class="hljs-string">"1500"</span>)
    )

  setUp(
    scn.inject(rampUsers(<span class="hljs-number">200</span>) during (<span class="hljs-number">20.</span>seconds))
  ).protocols(httpProtocol)
}
</div></code></pre>
<p>Run Gatling using the official <code>denvazh/gatling</code> or <code>gatling/gatling</code> image (images may vary). Example run:</p>
<pre class="hljs"><code><div>docker run --rm --network perf_demo_perfnet -v $(<span class="hljs-built_in">pwd</span>)/gatling/user-simulations:/opt/gatling/user-files/simulations \
  -v $(<span class="hljs-built_in">pwd</span>)/gatling:/opt/gatling/results \
  denvazh/gatling -s BasicSimulation
</div></code></pre>
<p>Gatling produces HTML reports in the container; mount a results directory to persist them.</p>
<hr>
<h1 id="7-notes-about-networks--hostnames">7) Notes about networks &amp; hostnames</h1>
<p>When running load generators in Docker and targeting the API container by service name, ensure all containers are on the same Docker network. Using <code>docker-compose up -d</code> creates a network named like <code>&lt;folder&gt;_perfnet</code>. If running with plain <code>docker run</code>, you can create and use the same network:</p>
<pre class="hljs"><code><div>docker network create perf_demo_perfnet
<span class="hljs-comment"># use --network perf_demo_perfnet in subsequent docker run commands</span>
</div></code></pre>
<p>Inside containers you can reach the API as <code>http://api:8000</code> (because service name in <code>docker-compose.yml</code> is <code>api</code>). From your host (curl, browser), use <code>http://localhost:8000</code>.</p>
<hr>
<h1 id="8-example-quick-smoke-test-locally-from-host">8) Example quick smoke test (locally from host)</h1>
<pre class="hljs"><code><div><span class="hljs-comment"># root endpoint</span>
curl http://localhost:8000/

<span class="hljs-comment"># CPU endpoint</span>
curl <span class="hljs-string">"http://localhost:8000/work/cpu?iterations=2000"</span>

<span class="hljs-comment"># Auth protected</span>
curl -H <span class="hljs-string">"X-API-KEY: secret-key"</span> http://localhost:8000/private
</div></code></pre>
<hr>
<h1 id="9-measuring-and-interpretation-tips">9) Measuring and interpretation tips</h1>
<ul>
<li>Always monitor the <strong>API container metrics</strong> (CPU, memory) while load-testing. Docker Desktop / <code>docker stats</code> or node exporters help.</li>
<li>Start with small load and ramp up: catch bottlenecks before overwhelming system.</li>
<li>Capture response time percentiles (p50/p95/p99) and error rates.</li>
<li>Test multiple scenarios: CPU-heavy, I/O-heavy, mixed traffic, file uploads, auth failures.</li>
<li>Use resource limits on containers to see graceful degradation.</li>
</ul>
<hr>
<h1 id="10-advanced-suggestions-optional">10) Advanced suggestions (optional)</h1>
<ul>
<li>Add a small Redis/Postgres service to test DB-backed endpoints.</li>
<li>Add a Prometheus + Grafana stack to collect and visualize metrics during tests.</li>
<li>Use <code>vegeta</code> for simple HTTP flood tests (not included above).</li>
<li>Run tests from multiple machines/hosts for larger distributed load.</li>
</ul>
<hr>
<h1 id="readme-quick-copy-paste">README quick copy-paste</h1>
<p>Create <code>perf-demo/README.md</code> with the essential steps (condensed):</p>
<pre class="hljs"><code><div><span class="hljs-section"># perf-demo</span>
<span class="hljs-bullet">
1. </span>Build &amp; run API:
   docker-compose up -d --build
<span class="hljs-bullet">
2. </span>Run k6:
   docker run --rm -i --network perf<span class="hljs-emphasis">_demo_</span>perfnet -v $(pwd)/k6/script.js:/script.js loadimpact/k6 run /script.js
<span class="hljs-bullet">
3. </span>Run Locust (UI):
   docker run --rm -p 8089:8089 -v $(pwd)/locust/locustfile.py:/locustfile.py --network perf<span class="hljs-emphasis">_demo_</span>perfnet locustio/locust -f /locustfile.py --host http://api:8000
<span class="hljs-bullet">
4. </span>Run JMeter (non-gui):
   docker run --rm --network perf<span class="hljs-emphasis">_demo_</span>perfnet -v $(pwd)/jmeter/test-plan.jmx:/test-plan.jmx justb4/jmeter -n -t /test-plan.jmx -l /results.jtl
<span class="hljs-bullet">
5. </span>Run Gatling:
   docker run --rm --network perf<span class="hljs-emphasis">_demo_</span>perfnet -v $(pwd)/gatling/user-simulations:/opt/gatling/user-files/simulations denvazh/gatling -s BasicSimulation

Notes:
<span class="hljs-bullet">- </span>Ensure docker network name matches the compose-created network (list with <span class="hljs-code">`docker network ls`</span>).
<span class="hljs-bullet">- </span>From inside containers target the API as http://api:8000
</div></code></pre>
<hr>
<h1 id="final-notes--quick-checklist">Final notes &amp; quick checklist</h1>
<ul>
<li>Files to create: <code>api/*</code>, <code>k6/script.js</code>, <code>locust/locustfile.py</code>, <code>jmeter/test-plan.jmx</code>, <code>gatling/user-simulations/BasicSimulation.scala</code>, and <code>docker-compose.yml</code>.</li>
<li>Start API with docker-compose.</li>
<li>Use the <code>--network</code> flag to place runners on the same network.</li>
<li>Start small loads and increase gradually; watch CPU/mem/errors.</li>
</ul>
<hr>
<p><strong>NOTE:</strong> This page is generated with assistance from AI tools.</p>

</body>
</html>
