<!DOCTYPE html>
<html>
<head>
<title>The MSD Book :: Factory Patterns</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="factory-patterns--why-where-how-with-a-ready-to-run-c-beforeafter">Factory patterns — why, where, how (with a ready-to-run C# before/after)</h1>
<p>
    <img src="msd-book-front.png" 
    alt="The MSD Book" width="200" style="float: left; margin: 0 1rem 1rem 0;"/>
    Short version: factories remove direct <code>new</code> calls from business logic, encapsulate creation, make it easy to add implementations, test, and switch families of related objects. Use them when creation logic is non-trivial, you need runtime selection, want to decouple code from concrete classes, or you need different families of related products (e.g., payment + receipt + notifier).</p>
<p>Below I show:</p>
<ul>
<li>
<p>A <strong>Before</strong>: small, realistic <code>OrderService</code> tightly coupled to concrete payment classes.</p>
</li>
<li>
<p>Two <strong>After</strong> refactors:</p>
<ol>
<li><strong>Simple Factory</strong> (easy first step)</li>
<li><strong>Abstract Factory</strong> (for families of related objects: payment + notification)</li>
</ol>
</li>
<li>
<p>A short <strong>lint-style checklist</strong> you can use in code reviews.</p>
</li>
</ul>
<hr>
<h1 id="1--before-tightly-coupled-example">1 — Before (tightly coupled example)</h1>
<p>This is a small console app where <code>OrderService</code> chooses a payment processor by string and constructs concrete classes directly. It's realistic: a business class calling <code>new</code> and doing <code>switch</code> on type.</p>
<pre class="hljs"><code><div><span class="hljs-comment">// File: Program.cs</span>
<span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">FactoryBefore</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
        {
            <span class="hljs-keyword">var</span> orderService = <span class="hljs-keyword">new</span> OrderService();
            orderService.PlaceOrder(<span class="hljs-number">42</span>, <span class="hljs-string">"stripe"</span>);
            orderService.PlaceOrder(<span class="hljs-number">43</span>, <span class="hljs-string">"paypal"</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrderService</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PlaceOrder</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> orderId, <span class="hljs-keyword">string</span> paymentType</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">$"Placing order <span class="hljs-subst">{orderId}</span>"</span>);

            IPaymentProcessor processor;
            <span class="hljs-comment">// creation logic embedded in business class</span>
            <span class="hljs-keyword">if</span> (paymentType == <span class="hljs-string">"stripe"</span>)
                processor = <span class="hljs-keyword">new</span> StripeProcessor(<span class="hljs-string">"sk_test_abc"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (paymentType == <span class="hljs-string">"paypal"</span>)
                processor = <span class="hljs-keyword">new</span> PayPalProcessor(<span class="hljs-string">"clientid"</span>, <span class="hljs-string">"secret"</span>);
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"Unknown payment type"</span>);

            <span class="hljs-keyword">var</span> result = processor.Charge(<span class="hljs-number">100.0</span>m);
            Console.WriteLine(<span class="hljs-string">$"Charge result: <span class="hljs-subst">{result}</span>"</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPaymentProcessor</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StripeProcessor</span> : <span class="hljs-title">IPaymentProcessor</span>
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> apiKey;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StripeProcessor</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> apiKey</span>)</span> =&gt; <span class="hljs-keyword">this</span>.apiKey = apiKey;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span> { Console.WriteLine(<span class="hljs-string">$"Stripe charging <span class="hljs-subst">{amount}</span> using <span class="hljs-subst">{apiKey}</span>"</span>); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PayPalProcessor</span> : <span class="hljs-title">IPaymentProcessor</span>
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> clientId;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> secret;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PayPalProcessor</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> clientId, <span class="hljs-keyword">string</span> secret</span>)</span> { <span class="hljs-keyword">this</span>.clientId = clientId; <span class="hljs-keyword">this</span>.secret = secret; }
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span> { Console.WriteLine(<span class="hljs-string">$"PayPal charging <span class="hljs-subst">{amount}</span> using <span class="hljs-subst">{clientId}</span>/<span class="hljs-subst">{secret}</span>"</span>); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
    }
}
</div></code></pre>
<p><strong>Problems:</strong></p>
<ul>
<li><code>OrderService</code> knows concrete classes and their ctor signatures.</li>
<li>Hard to test <code>OrderService</code> in isolation without providing real processors.</li>
<li>Adding a new payment provider requires changing <code>OrderService</code>.</li>
<li>Configuration (API keys) leaks into business logic.</li>
</ul>
<hr>
<h1 id="2--after--simple-factory-step-up">2 — After — Simple Factory (step-up)</h1>
<p>Create a single <code>PaymentFactory</code> that encapsulates creation/configuration. <code>OrderService</code> depends on an abstraction for factory and just asks for a processor. This is the <strong>Simple Factory</strong> pattern (not a formal Gang-of-Four pattern, but widely used).</p>
<pre class="hljs"><code><div><span class="hljs-comment">// File: Program.cs</span>
<span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">FactorySimple</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
        {
            <span class="hljs-comment">// Factory can be configured centrally</span>
            IPaymentFactory factory = <span class="hljs-keyword">new</span> PaymentFactory();
            <span class="hljs-keyword">var</span> orderService = <span class="hljs-keyword">new</span> OrderService(factory);

            orderService.PlaceOrder(<span class="hljs-number">101</span>, <span class="hljs-string">"stripe"</span>);
            orderService.PlaceOrder(<span class="hljs-number">102</span>, <span class="hljs-string">"paypal"</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrderService</span>
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPaymentFactory _factory;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OrderService</span>(<span class="hljs-params">IPaymentFactory factory</span>)</span> =&gt; _factory = factory;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PlaceOrder</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> orderId, <span class="hljs-keyword">string</span> paymentType</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">$"Placing order <span class="hljs-subst">{orderId}</span>"</span>);
            <span class="hljs-keyword">var</span> processor = _factory.Create(paymentType);
            <span class="hljs-keyword">var</span> result = processor.Charge(<span class="hljs-number">200.0</span>m);
            Console.WriteLine(<span class="hljs-string">$"Charge result: <span class="hljs-subst">{result}</span>"</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPaymentFactory</span>
    {
        <span class="hljs-function">IPaymentProcessor <span class="hljs-title">Create</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> paymentType</span>)</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PaymentFactory</span> : <span class="hljs-title">IPaymentFactory</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">public</span> IPaymentProcessor <span class="hljs-title">Create</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> paymentType</span>)</span>
        {
            <span class="hljs-comment">// factory centralizes construction/config</span>
            <span class="hljs-keyword">if</span> (paymentType == <span class="hljs-string">"stripe"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> StripeProcessor(apiKey: <span class="hljs-string">"sk_prod_xyz"</span>);
            <span class="hljs-keyword">if</span> (paymentType == <span class="hljs-string">"paypal"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PayPalProcessor(clientId: <span class="hljs-string">"client"</span>, secret: <span class="hljs-string">"secret"</span>);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"Unknown payment type"</span>);
        }
    }

    <span class="hljs-comment">// Payment interfaces/implementations same as before</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPaymentProcessor</span> { <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StripeProcessor</span> : <span class="hljs-title">IPaymentProcessor</span>
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> apiKey;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StripeProcessor</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> apiKey</span>)</span> =&gt; <span class="hljs-keyword">this</span>.apiKey = apiKey;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span> { Console.WriteLine(<span class="hljs-string">$"Stripe charging <span class="hljs-subst">{amount}</span>"</span>); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PayPalProcessor</span> : <span class="hljs-title">IPaymentProcessor</span>
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> clientId;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> secret;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PayPalProcessor</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> clientId, <span class="hljs-keyword">string</span> secret</span>)</span> { <span class="hljs-keyword">this</span>.clientId = clientId; <span class="hljs-keyword">this</span>.secret = secret; }
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span> { Console.WriteLine(<span class="hljs-string">$"PayPal charging <span class="hljs-subst">{amount}</span>"</span>); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; }
    }
}
</div></code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li><code>OrderService</code> no longer knows concrete classes.</li>
<li>Creation details (keys, client id) are localized in <code>PaymentFactory</code>.</li>
<li>Easy to change creation logic (caching, pooling, DI container bindings) without touching business code.</li>
<li>Easier to mock factory in tests to produce fake <code>IPaymentProcessor</code>.</li>
</ul>
<hr>
<h1 id="3--after--abstract-factory-for-related-families">3 — After — Abstract Factory (for related families)</h1>
<p>When the system needs to create <strong>families</strong> of related objects that must be used together (e.g., a <code>PaymentProcessor</code>, a <code>ReceiptGenerator</code>, and a <code>Notifier</code> that must be consistent for Stripe vs PayPal), use <strong>Abstract Factory</strong>. The Abstract Factory returns a suite of related objects.</p>
<p>Example: <code>IPaymentProviderFactory</code> produces <code>IPaymentProcessor</code> and <code>IReceiptSender</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment">// File: Program.cs</span>
<span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">FactoryAbstract</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
        {
            <span class="hljs-comment">// runtime selection of factories: choose PayPalFactory or StripeFactory</span>
            IPaymentProviderFactory factory = <span class="hljs-keyword">new</span> StripeProviderFactory(); <span class="hljs-comment">// or new PayPalProviderFactory();</span>
            <span class="hljs-keyword">var</span> orderService = <span class="hljs-keyword">new</span> OrderService(factory);
            orderService.PlaceOrder(<span class="hljs-number">201</span>, <span class="hljs-number">50.0</span>m);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrderService</span>
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPaymentProviderFactory _factory;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OrderService</span>(<span class="hljs-params">IPaymentProviderFactory factory</span>)</span> =&gt; _factory = factory;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PlaceOrder</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> orderId, <span class="hljs-keyword">decimal</span> amount</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">$"Placing order <span class="hljs-subst">{orderId}</span>"</span>);
            <span class="hljs-keyword">var</span> processor = _factory.CreateProcessor();
            <span class="hljs-keyword">var</span> receipt = _factory.CreateReceiptGenerator();
            <span class="hljs-keyword">var</span> notifier = _factory.CreateNotifier();

            <span class="hljs-keyword">var</span> charged = processor.Charge(amount);
            <span class="hljs-keyword">if</span> (charged)
            {
                <span class="hljs-keyword">var</span> receiptText = receipt.Generate(orderId, amount);
                notifier.Send(receiptText);
            }
        }
    }

    <span class="hljs-comment">// The Abstract Factory</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPaymentProviderFactory</span>
    {
        <span class="hljs-function">IPaymentProcessor <span class="hljs-title">CreateProcessor</span>(<span class="hljs-params"></span>)</span>;
        <span class="hljs-function">IReceiptGenerator <span class="hljs-title">CreateReceiptGenerator</span>(<span class="hljs-params"></span>)</span>;
        <span class="hljs-function">INotifier <span class="hljs-title">CreateNotifier</span>(<span class="hljs-params"></span>)</span>;
    }

    <span class="hljs-comment">// Stripe family</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StripeProviderFactory</span> : <span class="hljs-title">IPaymentProviderFactory</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">public</span> IPaymentProcessor <span class="hljs-title">CreateProcessor</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> StripeProcessor(<span class="hljs-string">"sk_live_stripe"</span>);
        <span class="hljs-function"><span class="hljs-keyword">public</span> IReceiptGenerator <span class="hljs-title">CreateReceiptGenerator</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> HtmlReceiptGenerator(<span class="hljs-string">"Stripe Inc."</span>);
        <span class="hljs-function"><span class="hljs-keyword">public</span> INotifier <span class="hljs-title">CreateNotifier</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> EmailNotifier(<span class="hljs-string">"no-reply@stripe.example"</span>);
    }

    <span class="hljs-comment">// PayPal family</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PayPalProviderFactory</span> : <span class="hljs-title">IPaymentProviderFactory</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">public</span> IPaymentProcessor <span class="hljs-title">CreateProcessor</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> PayPalProcessor(<span class="hljs-string">"client"</span>, <span class="hljs-string">"secret"</span>);
        <span class="hljs-function"><span class="hljs-keyword">public</span> IReceiptGenerator <span class="hljs-title">CreateReceiptGenerator</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> PdfReceiptGenerator(<span class="hljs-string">"PayPal LLC"</span>);
        <span class="hljs-function"><span class="hljs-keyword">public</span> INotifier <span class="hljs-title">CreateNotifier</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">new</span> SmsNotifier(<span class="hljs-string">"+1000000000"</span>);
    }

    <span class="hljs-comment">// Product interfaces</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPaymentProcessor</span> { <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IReceiptGenerator</span> { <span class="hljs-function"><span class="hljs-keyword">string</span> <span class="hljs-title">Generate</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> orderId, <span class="hljs-keyword">decimal</span> amount</span>)</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">INotifier</span> { <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Send</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span>; }

    <span class="hljs-comment">// Stripe implementations</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StripeProcessor</span> : <span class="hljs-title">IPaymentProcessor</span> { <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> key; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StripeProcessor</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> key</span>)</span> { <span class="hljs-keyword">this</span>.key = key; } <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span> { Console.WriteLine(<span class="hljs-string">$"Stripe processed <span class="hljs-subst">{amount}</span>"</span>); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; } }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HtmlReceiptGenerator</span> : <span class="hljs-title">IReceiptGenerator</span> { <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> company; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HtmlReceiptGenerator</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> company</span>)</span> { <span class="hljs-keyword">this</span>.company = company; } <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Generate</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> orderId, <span class="hljs-keyword">decimal</span> amount</span>)</span> =&gt; <span class="hljs-string">$"&lt;html&gt;Receipt <span class="hljs-subst">{orderId}</span> - <span class="hljs-subst">{amount}</span> - <span class="hljs-subst">{company}</span>&lt;/html&gt;"</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EmailNotifier</span> : <span class="hljs-title">INotifier</span> { <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> <span class="hljs-keyword">from</span>; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EmailNotifier</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-keyword">from</span></span>)</span> { <span class="hljs-keyword">this</span>.<span class="hljs-keyword">from</span> = <span class="hljs-keyword">from</span>; } <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Send</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">$"Email sent from <span class="hljs-subst">{<span class="hljs-keyword">from</span>}</span>: <span class="hljs-subst">{message}</span>"</span>); }

    <span class="hljs-comment">// PayPal implementations</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PayPalProcessor</span> : <span class="hljs-title">IPaymentProcessor</span> { <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PayPalProcessor</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> cid, <span class="hljs-keyword">string</span> secret</span>)</span> { } <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span> { Console.WriteLine(<span class="hljs-string">$"PayPal processed <span class="hljs-subst">{amount}</span>"</span>); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; } }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PdfReceiptGenerator</span> : <span class="hljs-title">IReceiptGenerator</span> { <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> company; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PdfReceiptGenerator</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> company</span>)</span> { <span class="hljs-keyword">this</span>.company = company; } <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Generate</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> orderId, <span class="hljs-keyword">decimal</span> amount</span>)</span> =&gt; <span class="hljs-string">$"PDF: Receipt <span class="hljs-subst">{orderId}</span> - <span class="hljs-subst">{amount}</span> - <span class="hljs-subst">{company}</span>"</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsNotifier</span> : <span class="hljs-title">INotifier</span> { <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> number; <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SmsNotifier</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> number</span>)</span> { <span class="hljs-keyword">this</span>.number = number; } <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Send</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">$"SMS to <span class="hljs-subst">{number}</span>: <span class="hljs-subst">{message}</span>"</span>); }
}
</div></code></pre>
<p><strong>Why this helps:</strong> you guarantee that all created products belong to the same family and are compatible. To switch to PayPal, you swap the factory. This is particularly useful when the products must be consistent (APIs, message formats, webhook expectations).</p>
<hr>
<h1 id="4--when-to-use-which-factory">4 — When to use which factory</h1>
<ul>
<li>
<p><strong>Simple Factory</strong></p>
<ul>
<li>Use as a pragmatic first step.</li>
<li>Good when selection logic is simple and you want to centralize configuration.</li>
<li>Low ceremony.</li>
</ul>
</li>
<li>
<p><strong>Factory Method</strong></p>
<ul>
<li>Use when subclasses decide which concrete product to create (i.e., class-based customization).</li>
<li>Common when you have several creators that differ by how they create objects.</li>
</ul>
</li>
<li>
<p><strong>Abstract Factory</strong></p>
<ul>
<li>Use when you need to create families of related objects that must be used together.</li>
<li>Good for plugin-like architectures (select provider -&gt; get consistent suite of objects).</li>
</ul>
</li>
<li>
<p><strong>When <em>not</em> to use</strong></p>
<ul>
<li>Don’t introduce factories prematurely for trivial <code>new</code> operations that don’t change. Over-application adds indirection.</li>
<li>If you only ever have one concrete implementation and no config will change, the factory buys little.</li>
</ul>
</li>
</ul>
<hr>
<h1 id="5--practical-tips--anti-patterns">5 — Practical tips / anti-patterns</h1>
<ul>
<li><strong>Avoid factories that leak configuration</strong> (e.g., passing raw secret strings everywhere). Prefer configuration objects, DI, or factory initialization in composition root.</li>
<li><strong>Keep factories simple</strong>: they should decide <em>what</em> and <em>how</em> to create; heavy business logic belongs elsewhere.</li>
<li><strong>Prefer DI containers for wiring</strong> if your app already uses DI; factories can still be helpful for runtime selection or creating transient resources.</li>
<li><strong>For testing</strong>, factories are a natural seam: inject a test factory that returns fakes/doubles.</li>
</ul>
<hr>
<h1 id="6--lint-style-checklist-for-code-reviews">6 — Lint-style checklist for code reviews</h1>
<p>Use this checklist to judge factory usage and object creation in reviews:</p>
<ol>
<li>
<p><strong>Construction separation</strong></p>
<ul>
<li><input type="checkbox" id="checkbox0"><label for="checkbox0">Does the business class avoid </label><code>new</code> for non-trivial collaborators?</li>
<li><input type="checkbox" id="checkbox1"><label for="checkbox1">If </label><code>new</code> appears, is it purely for value types or trivial local objects?</li>
</ul>
</li>
<li>
<p><strong>Single responsibility</strong></p>
<ul>
<li><input type="checkbox" id="checkbox2"><label for="checkbox2">Is creation logic centralized (factory/composition root) rather than scattered?</label></li>
</ul>
</li>
<li>
<p><strong>Configuration and secrets</strong></p>
<ul>
<li><input type="checkbox" id="checkbox3"><label for="checkbox3">Are API keys/configuration localized (e.g., injected into factory) and not hard-coded in business classes?</label></li>
</ul>
</li>
<li>
<p><strong>Testability</strong></p>
<ul>
<li><input type="checkbox" id="checkbox4"><label for="checkbox4">Can collaborators be mocked/stubbed easily (factory returns interface/abstraction)?</label></li>
<li><input type="checkbox" id="checkbox5"><label for="checkbox5">Are factories themselves small and easy to override in tests?</label></li>
</ul>
</li>
<li>
<p><strong>Appropriate abstraction</strong></p>
<ul>
<li><input type="checkbox" id="checkbox6"><label for="checkbox6">Is the chosen factory pattern justified (Simple / Factory Method / Abstract Factory)?</label></li>
<li><input type="checkbox" id="checkbox7"><label for="checkbox7">Is there evidence the indirection is needed (variety of implementations, runtime selection, families)?</label></li>
</ul>
</li>
<li>
<p><strong>Clarity</strong></p>
<ul>
<li><input type="checkbox" id="checkbox8"><label for="checkbox8">Is the factory’s API clear and minimal? (no long parameter lists that leak unrelated concerns)</label></li>
<li><input type="checkbox" id="checkbox9"><label for="checkbox9">Are naming conventions clear: </label><code>XFactory</code>, <code>XProviderFactory</code>, <code>CreateProcessor()</code> etc.?</li>
</ul>
</li>
<li>
<p><strong>Coupling</strong></p>
<ul>
<li><input type="checkbox" id="checkbox10"><label for="checkbox10">Do concrete classes avoid exposing ctor signatures that force caller knowledge?</label></li>
<li><input type="checkbox" id="checkbox11"><label for="checkbox11">Are interface types used rather than concrete types in consuming code?</label></li>
</ul>
</li>
<li>
<p><strong>Error handling</strong></p>
<ul>
<li><input type="checkbox" id="checkbox12"><label for="checkbox12">Does the factory validate inputs and throw clear exceptions for unsupported types?</label></li>
<li><input type="checkbox" id="checkbox13"><label for="checkbox13">Are fallbacks documented if a provider isn't available?</label></li>
</ul>
</li>
<li>
<p><strong>Performance / resource management</strong></p>
<ul>
<li><input type="checkbox" id="checkbox14"><label for="checkbox14">If creation is expensive, is factory responsible for pooling/caching or is the caller? (explicit responsibility)</label></li>
<li><input type="checkbox" id="checkbox15"><label for="checkbox15">Are disposable/managed resources handled correctly (factory returns IDisposable when needed)?</label></li>
</ul>
</li>
<li>
<p><strong>Extensibility</strong></p>
<ul>
<li><input type="checkbox" id="checkbox16"><label for="checkbox16">Can a new provider be added without touching business logic? (Open/Closed)</label></li>
</ul>
</li>
</ol>
<hr>
<h1 id="7--quick-migration-steps-practical-roadmap">7 — Quick migration steps (practical roadmap)</h1>
<ol>
<li>Identify places where code does <code>new</code> on external services or has <code>switch</code>/<code>if</code> selecting types.</li>
<li>Extract a simple factory interface <code>ICreateX</code> and implement a <code>DefaultXFactory</code>.</li>
<li>Replace direct <code>new</code> usage in business logic with <code>ICreateX</code> injection.</li>
<li>If several related resources must be created consistently, migrate to Abstract Factory.</li>
<li>Wire factories in your composition root (Startup, Program.cs, DI container).</li>
<li>Add tests that replace factories with test factories returning fakes.</li>
</ol>
<hr>
<p><strong>NOTE:</strong> This page is generated with assistance from AI tools.</p>

</body>
</html>
